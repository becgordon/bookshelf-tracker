{% extends 'loggedin_base.html' %}

{% block title %}{{ book.title }}{% endblock %}

{% block body %}

<main>
  <div id="book-change-text"></div>
  <div class="row align-items-md-stretch gy-4">
    <div class="col-4 m-5">
      <img src="{{ book.image }}" width="375px">
    </div>
    <div class="col-6 mt-5">
        <span>
          <h1>{{ book.title }}</h1>
        </span>
        <span>
          <h4>{{ book.author }}</h4>
        </span>
        <span>
          <br>
          {{ book.description }}
        </span>
        <span>
          <p>
            <br>
            Genre: {{ book.genre }}
          </p>
        </span>
        <span>
          <div id="isbn" name="{{ book.isbn }}">ISBN: {{ book.isbn }}</div>
        </span>
        <span>
          <br>
          <button id="remove_book">Remove book from library</button>
        </span>
        <span>
          <div>
            <br>
            <form id="category-form">
                <label for="category-select">Add book to shelf:</label>
                <select name="category" id="category-select">
                    <option value="To Be Read">To Be Read</option>
                    <option value="Have Read">Have Read</option>
                    <option value="Favorites">Favorites</option>
                </select>
                <input type="submit">
            </form>
            <br>
            </div>
        </span>
        <span>
          <div>
            {% if review.score == None %}
            <div>My Rating: Not Yet Rated</div>
            {% else %}
            <div>My Rating: {{ review.score }}</div>
            {% endif %}
            <form action="/ratebook{{ book.isbn }}">
                <label for="rating-select">Rate this book:</label>
                <select name="rating" id="rating-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <input type="submit">
            </form>
          </div>
        </span>
        <span>
          <div> 
            <br>
            {% if review.current_read == False %}
            <a href="/currentread/{{ book.isbn }}">Set as current read.</a>
            {% endif %}
            {% if review.current_read == True %}
            <a href="/currentread/{{ book.isbn }}">Finished reading.</a>
            {% endif %}
        </div>
        </span>
        <br>
        <span>
          On Shelves:
          {% if review.to_be_read == true %}To Be Read{% endif %}
          {% if review.to_be_read == false %}Have Read{% endif %}
          {% if review.favorites == true %}Favorites{% endif %}
        </span>
    </div>
  </div>

<script> 
    document.querySelector('#remove_book').addEventListener('click', () => {
        window.location = `/removebook${document.querySelector('#isbn').attributes.name.value}`;
    });

    function categorizeBook(evt){
        evt.preventDefault();
        fetch(`/categorizebook${document.querySelector('#isbn').attributes.name.value}/${document.querySelector('#category-select').value}`)
        .then((response) => response.text())
        .then((bookChangeMessage) => { 
            document.querySelector('#book-change-text').innerText = bookChangeMessage;
            })       
    }

    document.querySelector('#category-form').addEventListener('submit', categorizeBook);
</script>

{% endblock %}