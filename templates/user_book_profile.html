{% extends 'base.html' %}

{% block title %}{{ book.title }}{% endblock %}

{% block body %}

<nav class="navbar sticky-top navbar-expand-md bg-light">
  <div class="container-fluid d-flex">
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16">
      <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
    </svg>
    <a class="navbar-brand" href="/">Shelf-Help</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="menu">
      <div class="navbar-nav me-auto mb-2 mb-md-0">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">My Profile</a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/userprofile/{{ session['user_name'] }}">Library</a></li>
          <li><a class="dropdown-item" href="/usercharts/{{ session['user_name'] }}">Charts</a></li>
          <li><a class="dropdown-item" href="/viewallusers">View All Users</a></li>
          <li><a class="dropdown-item" href="/usersettings/{{ session['user_name'] }}">Settings</a></li>
        </ul>
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">My Shelves</a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/favoritesshelf">Favorites</a></li>
          <li><a class="dropdown-item" href="/tobereadsshelf">To Be Read</a></li>
          <li><a class="dropdown-item" href="/havereadsshelf">Have Read</a></li>
        </ul>
        <a class="nav-link" href="/logout">Log Out</a>
      </div>
        <form class="d-flex" role="search" method="GET" action="/booksearchresults">
          <input class="form-control me-2" type="search" placeholder="Search for a Book" aria-label="Search" name="search-term">
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
    </div>
  </div>
</nav>

<button id="remove_book">Remove book from library</button>

<div>
<form id="category-form">
    <label for="category-select">Add book to shelf:</label>
    <select name="category" id="category-select">
        <option value="To Be Read">To Be Read</option>
        <option value="Have Read">Have Read</option>
        <option value="Favorites">Favorites</option>
    </select>
    <input type="submit">
</form>
</div>

<div>
    <form action="/ratebook{{ book.isbn }}">
        <label for="rating-select">Rate this book:</label>
        <select name="rating" id="rating-select">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <input type="submit">
    </form>
  </div>

<div> 
    {% if review.current_read == False %}
    <a href="/currentread/{{ book.isbn }}">Set as current read.</a>
    {% endif %}
    {% if review.current_read == True %}
    <a href="/currentread/{{ book.isbn }}">Finished reading.</a>
    {% endif %}
</div>

<div id="book-change-text"></div>

<h1>{{ book.title }}</h1>
<div>{{ book.author }}</div>

{% if review.score == None %}
<div>My Rating: Not Yet Rated</div>
{% else %}
<div>My Rating: {{ review.score }}</div>
{% endif %}

<img src="{{ book.image }}">
<div>Genre: {{ book.genre }}</div>

{% if review.to_be_read == true %}
<div><h5>To Be Read</h5></div>
{% endif %}

{% if review.to_be_read == false %}
<div><h5>Have Read</h5></div>
{% endif %}

{% if review.favorites == true %}
<div><h5>Favorites</h5></div>
{% endif %}

<div>{{ book.description }}</div>
<div id="isbn" name="{{ book.isbn }}">ISBN: {{ book.isbn }}</div>

<script> 
    document.querySelector('#remove_book').addEventListener('click', () => {
        window.location = `/removebook${document.querySelector('#isbn').attributes.name.value}`;
    });

    function categorizeBook(evt){
        evt.preventDefault();
        fetch(`/categorizebook${document.querySelector('#isbn').attributes.name.value}/${document.querySelector('#category-select').value}`)
        .then((response) => response.text())
        .then((bookChangeMessage) => { 
            document.querySelector('#book-change-text').innerText = bookChangeMessage;
            })       
    }

    document.querySelector('#category-form').addEventListener('submit', categorizeBook);
</script>

{% endblock %}